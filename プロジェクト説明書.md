# ブランド管理システム - C#版

## プロジェクト概要

本プロジェクトは、Java（Servlet + MyBatis + Vue.js）技術スタックからC#（ASP.NET Core + Entity Framework Core + Blazor）技術スタックへ移行したブランド管理システムです。

## 技術スタック

| レイヤー | 技術 | バージョン |
|----------|------|------------|
| ランタイム | .NET | 9.0 |
| バックエンド | ASP.NET Core Web API | 9.0 |
| ORM | Entity Framework Core | 9.0 |
| データベース | MySQL | 5.x / 8.x |
| DBドライバー | Pomelo.EntityFrameworkCore.MySql | 9.0 |
| フロントエンド | Blazor Server | 9.0 |
| UIライブラリ | MudBlazor | 7.8.0 |

## プロジェクト構成

```
BrandCase/
├── BrandCase.sln                           # ソリューションファイル
│
├── BrandCase.Core/                         # コアビジネス層（クラスライブラリ）
│   ├── Entities/
│   │   └── Brand.cs                        # ブランドエンティティ
│   ├── DTOs/
│   │   ├── PagedResult.cs                  # ページング結果DTO
│   │   └── BrandQueryDto.cs                # 検索条件DTO
│   └── Interfaces/
│       └── IBrandService.cs                # ブランドサービスインターフェース
│
├── BrandCase.Infrastructure/               # インフラ層（クラスライブラリ）
│   ├── Data/
│   │   └── AppDbContext.cs                 # EF Coreデータベースコンテキスト
│   └── Services/
│       └── BrandService.cs                 # ブランドサービス実装
│
├── BrandCase.Api/                          # Web APIプロジェクト
│   ├── Controllers/
│   │   └── BrandController.cs              # ブランドAPIコントローラー
│   ├── Program.cs                          # APIエントリーポイント
│   └── appsettings.json                    # 設定ファイル
│
└── BrandCase.Blazor/                       # Blazor Serverフロントエンド
    ├── Pages/
    │   ├── Index.razor                     # ホームページ
    │   └── BrandManagement.razor           # ブランド管理ページ
    ├── Components/
    │   └── BrandDialog.razor               # ブランド追加ダイアログ
    ├── Shared/
    │   ├── MainLayout.razor                # メインレイアウト
    │   └── NavMenu.razor                   # ナビゲーションメニュー
    ├── Program.cs                          # Blazorエントリーポイント
    └── appsettings.json                    # 設定ファイル
```

## 機能モジュール

### ブランド管理
- **全件取得** - ブランド一覧を取得
- **ページング検索** - ページ単位で閲覧
- **条件検索** - ブランド名、企業名、ステータスで絞り込み
- **新規追加** - 新しいブランド情報を追加
- **一括削除** - 選択したブランドを一括削除

## データベース設定

### テーブル構造

既存のMySQLデータベースを使用。テーブル構造は以下の通り：

```sql
CREATE TABLE tb_brand (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '主キー',
    brand_name VARCHAR(100) COMMENT 'ブランド名',
    company_name VARCHAR(100) COMMENT '企業名',
    ordered INT COMMENT '表示順',
    description VARCHAR(500) COMMENT '説明',
    status INT COMMENT 'ステータス：0-無効、1-有効'
);
```

### 接続文字列設定

`appsettings.json`でデータベース接続を設定：

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=localhost;Database=db1;User=root;Password=root;"
  }
}
```

## クイックスタート

### 動作環境

- [.NET 9.0 SDK](https://dotnet.microsoft.com/download/dotnet/9.0)
- MySQL 5.7以上 または 8.0以上
- IDE（Visual Studio 2022 または VS Code推奨）

### 実行手順

#### 1. プロジェクトディレクトリへ移動

```bash
cd I:\brand-case\BrandCase
```

#### 2. データベース接続設定

以下のファイルで接続文字列を設定：
- `BrandCase.Api/appsettings.json`
- `BrandCase.Blazor/appsettings.json`

#### 3. パッケージ復元

```bash
dotnet restore
```

#### 4. ビルド

```bash
dotnet build
```

#### 5. アプリケーション起動

**方法1：Blazorアプリ起動（推奨、フロント・バック一体型）**

```bash
cd BrandCase.Blazor
dotnet run
```

アクセス：`https://localhost:5001` または `http://localhost:5000`

**方法2：Web API起動（バックエンド単独）**

```bash
cd BrandCase.Api
dotnet run
```

Swagger UI：`https://localhost:7112/swagger`

## APIリファレンス

### ベースパス
```
/api/Brand
```

### エンドポイント一覧

| メソッド | パス | 説明 | リクエストボディ |
|----------|------|------|------------------|
| GET | `/api/Brand` | 全ブランド取得 | - |
| POST | `/api/Brand` | ブランド追加 | Brand JSON |
| DELETE | `/api/Brand` | 一括削除 | int[] |
| GET | `/api/Brand/page` | ページング検索 | Query: currentPage, pageSize |
| POST | `/api/Brand/page` | 条件付きページング検索 | Query + BrandQueryDto |

### リクエスト・レスポンス例

#### ブランド追加
```http
POST /api/Brand
Content-Type: application/json

{
  "brandName": "ソニー",
  "companyName": "ソニーグループ株式会社",
  "ordered": 1,
  "description": "エレクトロニクス・エンターテインメント企業",
  "status": 1
}
```

#### 条件付きページング検索
```http
POST /api/Brand/page?currentPage=1&pageSize=10
Content-Type: application/json

{
  "brandName": "ソ",
  "companyName": "",
  "status": 1
}
```

**レスポンス：**
```json
{
  "totalCount": 15,
  "rows": [
    {
      "id": 1,
      "brandName": "ソニー",
      "companyName": "ソニーグループ株式会社",
      "ordered": 1,
      "description": "エレクトロニクス・エンターテインメント企業",
      "status": 1,
      "statusStr": "有効"
    }
  ]
}
```

#### 一括削除
```http
DELETE /api/Brand
Content-Type: application/json

[1, 2, 3]
```

## アーキテクチャ

```
┌─────────────────────────────────────────────────────────┐
│                    Blazor Server                         │
│                 (MudBlazor UIコンポーネント)              │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│                   ASP.NET Core                           │
│              (Web API / Blazor Hub)                      │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│                  BrandService                            │
│                  (ビジネスロジック層)                     │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│              Entity Framework Core                       │
│                  (データアクセス層)                       │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│                     MySQL                                │
│                   (tb_brand)                             │
└─────────────────────────────────────────────────────────┘
```

## Java版との比較

| 機能 | Java実装 | C#実装 |
|------|----------|--------|
| Webフレームワーク | Servlet 3.1 | ASP.NET Core 9 |
| ルーティング | @WebServlet + リフレクション | [ApiController] + 属性ルーティング |
| ORM | MyBatis | Entity Framework Core |
| JSON処理 | FastJSON | System.Text.Json |
| フロントエンド | Vue.js + Element UI | Blazor Server + MudBlazor |
| DI | 手動生成 | 組み込みDIコンテナ |
| 非同期処理 | 同期 | async/await |

## 開発ガイド

### 新規エンティティ追加手順

1. `BrandCase.Core/Entities`にエンティティクラスを作成
2. `AppDbContext`に`DbSet<T>`を追加
3. `BrandCase.Core/Interfaces`にサービスインターフェースを定義
4. `BrandCase.Infrastructure/Services`にサービスを実装
5. `Program.cs`にサービスを登録

### データベースマイグレーション

```bash
# マイグレーション追加
dotnet ef migrations add InitialCreate -p BrandCase.Infrastructure -s BrandCase.Api

# データベース更新
dotnet ef database update -p BrandCase.Infrastructure -s BrandCase.Api
```

## 注意事項

1. **データベース接続**：MySQLサービスが起動していること、接続文字列が正しいことを確認
2. **ポート競合**：ポート競合の場合は`launchSettings.json`でポートを変更
3. **HTTPS証明書**：開発環境では初回実行時に証明書の信頼が必要：
   ```bash
   dotnet dev-certs https --trust
   ```

## ライセンス

本プロジェクトは学習・参考目的のみに使用してください。
